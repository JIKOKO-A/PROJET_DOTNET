<UserControl x:Class="HRManagementApp.Views.UserManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:HRManagementApp.ViewModels">
    <UserControl.DataContext>
        <vm:UserManagementViewModel />
    </UserControl.DataContext>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- User List -->
        <Border Grid.Column="0" Margin="10" Padding="10" Background="White" CornerRadius="5">
            <Border.Effect>
                <DropShadowEffect Color="Gray" BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="System Users" FontSize="20" FontWeight="Bold" Margin="0,0,0,10"/>

                <DataGrid Grid.Row="1"
                         ItemsSource="{Binding Users}"
                         SelectedItem="{Binding SelectedUser}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         SelectionMode="Single"
                         CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="*"/>
                        <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="*"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="*"/>
                        <DataGridTextColumn Header="Role" Binding="{Binding Role}" Width="Auto"/>
                        <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="Auto"/>
                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedDate, StringFormat='{}{0:yyyy-MM-dd}'}" Width="Auto"/>
                        <DataGridTextColumn Header="Last Login" Binding="{Binding LastLoginDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="Auto"/>
                        <DataGridTemplateColumn Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Edit" 
                                           Command="{Binding DataContext.SelectUserCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                           CommandParameter="{Binding}"
                                           Padding="10,5"
                                           Background="#3498DB"
                                           Foreground="White"
                                           BorderThickness="0"
                                           Cursor="Hand"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- User Form -->
        <ScrollViewer Grid.Column="1" 
                     VerticalScrollBarVisibility="Auto" 
                     HorizontalScrollBarVisibility="Disabled"
                     Margin="10">
            <Border Padding="20" Background="White" CornerRadius="5">
                <Border.Effect>
                    <DropShadowEffect Color="Gray" BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                </Border.Effect>
                <StackPanel>
                <TextBlock Text="User Details" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Username:" Margin="0,0,10,10" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Username}" Margin="0,0,0,10" Padding="5"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Password:" Margin="0,0,10,10" VerticalAlignment="Center"/>
                    <PasswordBox Grid.Row="1" Grid.Column="1" x:Name="PasswordBox" Margin="0,0,0,10" Padding="5" PasswordChanged="PasswordBox_PasswordChanged"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Full Name:" Margin="0,0,10,10" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding FullName}" Margin="0,0,0,10" Padding="5"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Email:" Margin="0,0,10,10" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Email}" Margin="0,0,0,10" Padding="5"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Role:" Margin="0,0,10,10" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="4" Grid.Column="1" 
                             ItemsSource="{Binding UserRoles}"
                             SelectedItem="{Binding SelectedRole}"
                             Margin="0,0,0,10" 
                             Padding="5"/>

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Active:" Margin="0,0,10,20" VerticalAlignment="Center"/>
                    <CheckBox Grid.Row="5" Grid.Column="1" IsChecked="{Binding IsActive}" Margin="0,0,0,20" VerticalAlignment="Center"/>

                    <Button Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2"
                           Content="Add User"
                           Command="{Binding AddUserCommand}"
                           Padding="0,10"
                           Background="#27AE60"
                           Foreground="White"
                           BorderThickness="0"
                           Cursor="Hand"
                           Margin="0,0,0,10"/>

                    <Button Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2"
                           Content="Update User"
                           Command="{Binding UpdateUserCommand}"
                           Padding="0,10"
                           Background="#3498DB"
                           Foreground="White"
                           BorderThickness="0"
                           Cursor="Hand"
                           Margin="0,0,0,10"/>

                    <Button Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="2"
                           Content="Delete User"
                           Command="{Binding DeleteUserCommand}"
                           Padding="0,10"
                           Background="#E74C3C"
                           Foreground="White"
                           BorderThickness="0"
                           Cursor="Hand"
                           Margin="0,0,0,10"/>

                    <Button Grid.Row="9" Grid.Column="0" Grid.ColumnSpan="2"
                           Content="Clear Form"
                           Command="{Binding ClearFormCommand}"
                           Padding="0,10"
                           Background="#95A5A6"
                           Foreground="White"
                           BorderThickness="0"
                           Cursor="Hand"/>

                    <TextBlock Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="2"
                              Text="Note: Leave password empty when updating to keep existing password."
                              FontSize="10"
                              Foreground="Gray"
                              TextWrapping="Wrap"
                              Margin="0,20,0,0"/>
                </Grid>
                </StackPanel>
            </Border>
        </ScrollViewer>
    </Grid>
</UserControl>

